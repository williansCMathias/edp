var HOME = $("body").hasClass("home");

var BRAND = $("body").hasClass("brand");

var SEARCH = $("body").hasClass("search-result");

var PRODUTO = $("body").hasClass("product");

var CATALOG = $("body").hasClass("catalog");

var ACCOUNT = $("body").hasClass("account");

var CATEGORY = $("body").hasClass("category");

var DEPARTMENT = $("body").hasClass("department");

var EMPTYSEARCH = $("body").hasClass("buscaVazia");

var INSTITUCIONAL = $("body").hasClass("institucional");

var MOBILEBREAK = 767;

var TABLETBREAK = 1025;

var fns = {
    acordeon: function() {
        if ($(".acordeon-wrap .acordeon-toggle").attr("data-initial") != "open") {
            $(".acordeon-wrap .acordeon-toggle").slideUp();
        }
        $(".acordeon-start").live("click", function() {
            if ($(this).parents(".acordeon-wrap").hasClass("active")) {
                $(this).parents(".acordeon-wrap").removeClass("active");
            } else {
                $(this).parents(".acordeon-wrap").addClass("active");
            }
            $(this).parents(".acordeon-wrap").find(".acordeon-toggle").slideToggle();
        });
    },
    isMobile: function() {
        var userAgent = navigator.userAgent.toLowerCase();
        if (userAgent.search(/(android|avantgo|blackberry|iemobile|nokia|lumia|bolt|boost|cricket|docomo|fone|hiptop|mini|mobi|palm|phone|pie|tablet|up\.browser|up\.link|webos|wos)/i) != -1) {
            $(".lightboxOverlay").remove();
        }
    },
    verifyWidth: function() {
        if ($(window).width() <= 1024) {
            $("body").addClass("isMobile");
            $("body").removeClass("notMobile");
            return true;
        } else {
            $("body").removeClass("isMobile");
            $("body").addClass("notMobile");
            return false;
        }
    },
    sliderScroll: function(target) {
        var select = target;
        $(select).slideDown(function() {
            $("html, body").animate({
                scrollTop: 0
            }, 600);
        });
    },
    resizeHeigth: function(largura, altura, larguraDesejada) {
        var total = altura * larguraDesejada;
        total = total / largura;
        var dimensions = {
            largura: larguraDesejada,
            altura: total
        };
        return dimensions;
    },
    formObject: function($form) {
        var obj = {};
        $form.find("input").each(function() {
            var value;
            var name;
            if ($(this).attr("type") == "checkbox" && $(this).is(":checkd")) {
                value = $(this).val();
                name = $(this).attr("name");
            }
            if ($(this).attr("type") == "option" && $(this).is(":checkd")) {
                value = $(this).val();
                name = $(this).attr("name");
            }
            if ($(this).attr("type") != "option" && $(this).attr("type") != "checkbox") {
                value = $(this).val();
                name = $(this).attr("name");
            }
            obj[name] = value;
        });
        $form.find("select").each(function() {
            var value = $(this).find("option:selected").val();
            var name = $(this).attr("name");
            obj[name] = value;
        });
        $form.find("textarea").each(function() {
            var value = $(this).val();
            var name = $(this).attr("name");
            obj[name] = value;
        });
        return obj;
    },
    tab: function() {
        $(".details-abas .aba").on("click", function() {
            $(".details-abas .aba, .wrap-aba").removeClass("active");
            var _this = $(this);
            var target = _this.attr("data-target");
            _this.addClass("active");
            $(".details-abas .wrap-aba" + target).addClass("active");
        });
    },
    customScroll: function(element) {
        element.mCustomScrollbar({
            axis: "y"
        });
    },
    getMasterData: function(url) {
        return $.ajax({
            headers: {
                Accept: "application/vnd.vtex.ds.v10+json",
                "Content-Type": "application/json",
                "REST-Range": "resources=0-1"
            },
            type: "GET",
            url: url
        });
    },
    saveMasterDate: function(entidade, data, sucessoMsg, form, alert) {
        if (sucessoMsg == null || sucessoMsg == undefined) {
            sucessoMsg = "Dados salvos com sucesso!";
        }
        $.ajax({
            url: "/emporiodaspatas/dataentities/" + entidade + "/documents/",
            dataType: "json",
            type: "PATCH",
            crossDomain: true,
            data: JSON.stringify(data),
            headers: {
                Accept: "application/vnd.vtex.ds.v10+json",
                "Content-Type": "application/json; charset=utf-8"
            },
            success: function(dataJson) {
                if (alert) {
                    alert(sucessoMsg);
                }
                if (form.size()) {
                    form.each(function() {
                        this.reset();
                    });
                }
            }
        });
    },
    validaEmail: function(email) {
        var re = /^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i;
        return re.test(email);
    },
    newsletter: function($form) {
        $form.on("submit", function(e) {
            e.preventDefault();
            var _self = $(this);
            var fields = fns.formObject($form);
            if (fields.email.length == 0) {
                alert("Preencha todos os campos!");
            } else {
                if (fns.validaEmail(fields.email)) {
                    $.ajax({
                        headers: {
                            Accept: "application/vnd.vtex.ds.v10+json",
                            "Content-Type": "application/json",
                            "REST-Range": "resources=0-1"
                        },
                        type: "GET",
                        url: "/emporiodaspatas/dataentities/NL/search?_fields=id,email&_where=email=" + fields.email
                    }).done(function(clientInfo) {
                        if (clientInfo.length == 0) {
                            fns.saveMasterDate("NL", fields, null, _self, false);
                            $("#newsletter-modal .active").removeClass("active");
                            $("#newsletter-modal .success").addClass("active");
                        } else {
                            alert("E-mails já restá cadastrado!");
                            $("#newsletter-modal .active").removeClass("active");
                            $("#newsletter-modal .error").addClass("active");
                        }
                    });
                }
            }
        });
    }
};

var slider = {
    slideShelf: function($shelf, desktopShow, tabletShow, mobileShow, desktopScroll, tabletScroll, mobileScroll, desktopDots, tabletDots, mobileDots, desktopArrow, tabletArrow, mobileArrow) {
        $shelf.slick({
            dots: desktopDots,
            arrows: desktopArrow,
            slidesToShow: desktopShow,
            slidesToScroll: desktopScroll,
            nextArrow: '<button type="button" class="slick-arrow slick-next"><i class="ico-arrow"></i></button>',
            prevArrow: '<button type="button" class="slick-arrow slick-prev"><i class="ico-arrow"></i></button>',
            responsive: [ {
                breakpoint: TABLETBREAK,
                settings: {
                    dots: tabletDots,
                    arrows: tabletArrow,
                    slidesToShow: tabletShow,
                    slidesToScroll: tabletScroll
                }
            }, {
                breakpoint: MOBILEBREAK,
                settings: {
                    dots: mobileDots,
                    arrows: mobileArrow,
                    slidesToShow: mobileShow,
                    slidesToScroll: mobileScroll
                }
            } ]
        });
    },
    singleSlider: function($element, dots, arrows) {
        $element.slick({
            slidesToShow: 1,
            slidesToScroll: 1,
            dots: dots,
            arrows: arrows,
            nextArrow: '<button type="button" class="slick-arrow slick-next"><i class="ico-arrow"></i></button>',
            prevArrow: '<button type="button" class="slick-arrow slick-prev"><i class="ico-arrow"></i></button>'
        });
    },
    thumbProductSlider: function() {}
};

var global = {
    selectToggle: function() {
        $(".enterAccount .select, .enterAccount .triangle").live("click", function(e) {
            e.preventDefault();
            if ($(this).parents(".dropdown").hasClass("active")) {
                $(this).parents(".dropdown").removeClass("active");
            } else {
                $(this).parents(".dropdown").addClass("active");
            }
        });
    },
    headerFix: function() {
        var previousScroll = 0;
        var headerHeight = $(".pageheader").height();
        $(window).scroll(function() {
            var currentScroll = $(this).scrollTop();
            if (currentScroll < previousScroll && $(window).scrollTop() >= headerHeight) {
                $(".pageHeader").addClass("slidUp");
                $(".pageHeader").removeClass("slideDown");
            } else if ($(window).scrollTop() >= 30) {
                $(".pageHeader").addClass("slideDown");
                $(".pageHeader").removeClass("slidUp");
            }
            if (currentScroll == 0) {
                $(".pageHeader").removeClass("slidUp");
                $(".pageHeader").removeClass("slideDown");
                $(".pageHeader").removeClass("floatHeader");
            } else {
                $(".pageHeader").addClass("floatHeader");
            }
            previousScroll = currentScroll;
        });
    },
    searchResizeImage: function() {
        $(document).ajaxStop(function() {
            $(".pageHeader .main-header .search-box").append($("ul.ui-autocomplete"));
            setTimeout(function() {
                if ($(".ui-autocomplete .ui-menu-item img").length != 0) {
                    $(".ui-autocomplete .ui-menu-item img").each(function() {
                        $(this).attr("src", $(this).attr("src").replace("25-25", "60-60"));
                    });
                }
            }, 100);
        });
    },
    mobileMenu: function() {
        if (window.innerWidth <= 1024) {
            $(".toggle-menu--button, .mobile-navegation-header .toggle-menu, .pageHeader .overlay").on("click", function() {
                $(".navegation-header").toggleClass("active");
            });
            $(".navegation-sub-menu").slideUp();
            $(".toggle-sub-menu").on("click", function(e) {
                e.preventDefault();
                $(this).parents("li.has-sub-menu").find(".navegation-sub-menu").slideToggle();
            });
        }
    },
    footerMobileAccordeon: function() {
        if (window.innerWidth < 1025) {
            $("footer .wrap-accordeon").slideUp();
            $("footer .start-accordeon").on("click touch", function(e) {
                e.preventDefault();
                if (!$(this).next().hasClass("active")) {
                    $(this).next().addClass("active");
                } else {
                    $(this).next().removeClass("active");
                }
                $(this).next().slideToggle();
            });
        }
    },
    newsletter: function() {
        fns.newsletter($("#nesletter-footer"));
    },
    isLogged: function() {
        vtexjs.checkout.getOrderForm().done(function(data) {
            var userName;
            if (data.loggedIn) {
                if (data.clientProfileData.firstName != null) {
                    userName = data.clientProfileData.firstName;
                } else {
                    userName = data.clientProfileData.email.split("@")[0];
                }
                $(".slect-text > a").text(userName);
                $(window).load(function() {
                    $(".welcomeMsg .welcome em a").text("Sair ou Entrar com outra conta");
                });
            }
        });
    },
    init: function() {
        global.selectToggle();
        global.headerFix();
        global.mobileMenu();
        global.newsletter();
        global.searchResizeImage();
        global.footerMobileAccordeon();
        global.isLogged();
        $("#back-to-top").on("click", function() {
            $("html, body").animate({
                scrollTop: 0
            }, 600);
        });
    }
};

var catalog = {
    init: function() {
        catalog.numberResult();
        catalog.smartResearch();
        catalog.menuFilterToggle();
        catalog.orders();
        catalog.clearFilter();
        catalog.departementNavigator();
        catalog.flagDiscount();
        if (SEARCH) {
            catalog.identifySearchPage();
            catalog.searchBradCrumb();
            catalog.searchResult();
        }
        var qtlProduct = $(".resultado-busca-numero .value").eq(0).text();
        $(".info-navigator .outher-info span").text(qtlProduct);
        if (DEPARTMENT) {
            var currentDep = $(".bread-crumb .last").text();
            $(".info-navigator .page-name h1").text("Produtos para " + currentDep);
        }
    },
    flagDiscount: function() {
        $(".flagDiscount").each(function() {
            var descpct = $(this).text().replace(",", ".");
            descpct = descpct.replace(" %", "");
            descpct = parseFloat(descpct);
            descpct = descpct.toFixed(0);
            if (descpct == "0" || descpct == 0) {
                $(this).hide();
            } else {
                $(this).show().addClass("active");
                $(this).html("<span><strong>" + descpct + "%</strong> off</span>");
            }
        });
    },
    clearFilter: function() {
        $("button.clear-filter").on("click", function(e) {
            e.preventDefault();
            $('[class^="refino"] label.sr_selected, [class*=" refino"] label.sr_selected').each(function() {
                $(this).trigger("click");
                $(".filter").remove();
            });
        });
    },
    departementNavigator: function() {
        if ($("ul.productClusterSearchableIds").size() > 0) {
            var templateCluster = "";
            templateCluster += '<div class="acordeon-wrap">';
            templateCluster += '<div class="acordeon-start"><h6> Coleções <span><i class="ico-arrow"></i> </span></h6></div>';
            templateCluster += '<div class="acordeon-toggle">';
            templateCluster += "</div>";
            templateCluster += "</div>";
            $(".search-multiple-navigator").prepend($("<div>", {
                "class": "wrap-cluster"
            }));
            $(".search-multiple-navigator > .wrap-cluster").append(templateCluster);
            $(".search-multiple-navigator > .wrap-cluster .acordeon-toggle").append($(".productClusterSearchableIds"));
        }
        var currentDep = vtxctx.departmentyId;
        var currentCat = vtxctx.categoryId;
        var template = "";
        var level = window.location.pathname.split("/").length - 1;
        $(".search-multiple-navigator").prepend($("<div>", {
            "class": "wrap-category"
        }));
        template += '<div class="acordeon-wrap">';
        template += '<div class="acordeon-start"><h6> Categorias <span><i class="ico-arrow"></i> </span></h6></div>';
        template += '<div class="acordeon-toggle" data-initial="open">';
        template += "<ul>";
        $.get("/api/catalog_system/pub/category/tree/5").done(function(data) {
            $.each(data, function(i, category) {
                if (currentDep == category.id) {
                    $.each(category.children, function(j, subCategory) {
                        if (currentCat == subCategory.id) {
                            template += '<li><a href="' + subCategory.url + '">' + subCategory.name + "</a></li>";
                            $.each(subCategory.children, function(k, subCategory) {
                                template += '<li><a href="' + subCategory.url + '">' + subCategory.name + "</a></li>";
                            });
                        } else {
                            if (level == 1) {
                                template += '<li><a href="' + subCategory.url + '">' + subCategory.name + "</a></li>";
                            }
                        }
                    });
                }
            });
            template += "</ul>";
            template += "</div>";
            template += "</div>";
            $(".search-multiple-navigator > .wrap-category").append(template);
            if ($(".search-multiple-navigator > .wrap-category ul li").size() == 0) {
                $(".search-multiple-navigator > .wrap-category").hide();
            }
            fns.acordeon();
            fns.customScroll($(".acordeon-wrap .acordeon-toggle"));
        });
    },
    identifySearchPage: function() {
        if (!$(".menu-navegue").length) {
            $("body").addClass("firstLevel");
        } else {
            fns.customScroll($(".search-multiple-navigator fieldset div"));
        }
    },
    numberResult: function() {
        var numberResult = $(".searchResultsTime .resultado-busca-numero .value").eq(0).text();
        $(".productResult").append("<span>Produtos encontrados: <strong>" + numberResult + "</strong></span>");
    },
    menuFilterToggle: function() {
        $(".filterMobileToggle").on("click", function(e) {
            if (fns.verifyWidth()) {
                e.preventDefault();
                $(".navSidebar").addClass("open");
                $("body").addClass("menuOpen");
                $(".navOverlay").addClass("active").fadeIn(300);
            }
        });
        $(".navSidebarHead .ico-close, .navOverlay").on("click", function(e) {
            if (fns.verifyWidth()) {
                e.preventDefault();
                $(".navSidebar").removeClass("open");
                $("body").removeClass("menuOpen");
                $(".navOverlay").removeClass("active").fadeOut(300);
            }
        });
        if (DEPARTMENT || CATEGORY || SEARCH) {
            var SELETOR = ".search-multiple-navigator fieldset h5";
            $(SELETOR).append('<span><i class="ico-arrow"></i> </span>');
            $(SELETOR).on("click", function(e) {
                e.preventDefault();
                $(this).parents("fieldset").toggleClass("active");
                $(this).next("div").slideToggle();
            });
            $(".search-single-navigator h5").on("click", function(e) {
                e.preventDefault();
                $(this).toggleClass("active");
                $(this).next("ul").slideToggle();
            });
        }
    },
    searchBradCrumb: function() {
        var searchString = $(".searchResultsTime .resultado-busca-termo .value").eq(0).text();
        var templateLink = $('<li class="last"><a href="/">Busca: ' + searchString + " X</a></li>");
        $(".bread-crumb ul").append(templateLink);
    },
    searchResult: function() {
        var searchString = $(".searchResultsTime .resultado-busca-termo .value").eq(0).text().length ? $(".searchResultsTime .resultado-busca-termo .value").eq(0).text() : dataLayer[0].pageTitle;
        var numberResult = $(".searchResultsTime .resultado-busca-numero .value").eq(0).text();
        $(".searchDisplay").append('<div class="big"><p><i class="ico-lupa"></i> Você buscou por: <span>"' + searchString + '"</span></p></div> <div class="small"><p>Encontramos <span>"' + numberResult + '"</span> resultados</p></div>');
    },
    emptySearch: function() {
        slider.slideShelf($(".slide-shelf .shelf > ul"), 4, 3, 1, 4, 3, 1, false, false, false, true, true, true);
        var word = $('meta[name="Abstract"]').attr("content");
        $("#keyword").text('"' + word + '"');
    },
    groupFilters: function() {
        $(".search-single-navigator ul").each(function() {
            if (!$(this).find("li").length) {
                $(this).prev().addClass("noItems");
                $(this).remove();
            } else {
                fns.customScroll($(this));
            }
        });
        $(".filterOptions h4, .filterOptions h5").each(function() {
            if (!$(this).hasClass("noItems")) {
                $(this).addClass("hided").append('<i class="ico-arrow"></i>');
            }
        });
        $(".filterOptions h4 i, .filterOptions h5 i").on("click", function() {
            $(this).parent().stop(true, true).toggleClass("hided");
        });
        var currentDep = $(".bread-crumb .last").text();
        var qtlProduct = $(".resultado-busca-numero .value").eq(0).text();
        $(".info-navigator .outher-info span").text(qtlProduct);
    },
    orders: function() {
        $(".contentOrders .buttonOrder").live("click", function(e) {
            e.preventDefault();
            var order = $(this).attr("href");
            if (window.location.search != "" || window.location.search.length > 0) {
                var search = window.location.search.split("&O")[0];
                window.location.href = window.location.pathname + search + "&O=" + order;
            } else {
                window.location.href = window.location.pathname + "?PS=12&O=" + order;
            }
        });
        var str = $(".resultado-busca-numero span.value").eq(0).text();
        $("#numbe-result").append(str);
        $(".catalog-options .orderBy.filters").live("click", function() {
            $(".orderBy.filters .contentOrders").slideToggle();
        });
        $(".filterMobileToggle, .navSidebarHead .ico-close, button.overlay, .close-filter").on("click", function(e) {
            e.preventDefault();
            $(".navSidebar").toggleClass("active");
        });
        $("#orderBy").on("change", function(e) {
            e.preventDefault();
            var order = $(this).find("option:selected").val();
            if (window.location.search != "" || window.location.search.length > 0) {
                var search = window.location.search.split("&O")[0];
                window.location.href = window.location.pathname + search + "&O=" + order;
            } else {
                window.location.href = window.location.pathname + "?PS=12&O=" + order;
            }
        });
    },
    smartResearch: function() {
        $(".navSidebar .filterOptions input[type='checkbox']").vtexSmartResearch({
            ajaxCallback: function() {
                $("li.helperComplement").remove();
            },
            shelfCallback: function() {
                $("li.helperComplement").remove();
            }
        });
    }
};

var home = {
    getBlogPosts: function() {
        $.get("//blog.emporiodaspatas.com.br/wp-json/wp/v2/posts?_embed").done(function(resp) {
            for (var i = 0; i < 3; i++) {
                if (i < resp.length) {
                    var template = "";
                    var thisNewDATE = resp[i].date;
                    var imge = resp[i]["_embedded"]["wp:featuredmedia"][0].media_details.sizes.medium.source_url;
                    var link = resp[i].link;
                    var title = resp[i].title.rendered;
                    var contentSnippet = resp[i].excerpt.rendered;
                    console.log(imge);
                    template += '<div class="wrap-post">';
                    template += '<div class="post-image">';
                    template += '<a href="' + link + '" target="_blank"><img src="' + imge + '" alt="" /></a>';
                    template += '<a class="button-more" href="' + link + '" target="_blank">+</a>';
                    template += "</div>";
                    template += '<div class="post-info">';
                    template += "<small>" + thisNewDATE + "</small>";
                    template += '<h3 class="post-info__title">' + title + "</h3>";
                    template += "</div>";
                    template += '<div class="post-previw">';
                    template += "<p>" + contentSnippet + "</p>";
                    template += '<a class="ready-more" href="' + link + '" target="_blank">Continue lendo</a>';
                    template += "</div>";
                    template += "</div>";
                    $("#wrap-blog-items").append(template);
                }
            }
        });
    },
    instagramFeed: function() {
        var feed = new Instafeed({
            get: "user",
            target: "instagram",
            userId: 5385166224,
            accessToken: "5385166224.1677ed0.a0d3328f6e7d4e7296146927359d0a87",
            link: "true",
            clientId: "5385166224",
            limit: "5",
            resolution: "low_resolution",
            template: '<a href="{{link}}" class="instagramImage" target="_blank"><img src="{{image}}" /></a>'
        });
        window.onload = function() {
            feed.run();
        };
    },
    slider: function() {
        slider.singleSlider($(".fullGallery"), true, true);
        slider.slideShelf($(".slide-shelf .shelf > ul"), 4, 3, 1, 4, 3, 1, false, false, false, true, true, true);
        $(".wrap-marcas").slick({
            infinite: true,
            slidesToShow: 6,
            slidesToScroll: 2,
            arrows: true,
            speed: 500,
            nextArrow: '<button type="button" class="slick-arrow slick-next"><i class="ico-arrow"></i></button>',
            prevArrow: '<button type="button" class="slick-arrow slick-prev"><i class="ico-arrow"></i></button>',
            responsive: [ {
                breakpoint: TABLETBREAK,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3,
                    dots: true
                }
            }, {
                breakpoint: MOBILEBREAK,
                settings: {
                    slidesToShow: 2,
                    slidesToScroll: 2,
                    dots: false
                }
            } ]
        });
        $(".pitch-bar-slider > ul").slick({
            infinite: true,
            slidesToShow: 5,
            slidesToScroll: 2,
            arrows: false,
            speed: 500,
            nextArrow: '<button type="button" class="slick-arrow slick-next"><i class="ico-arrow"></i></button>',
            prevArrow: '<button type="button" class="slick-arrow slick-prev"><i class="ico-arrow"></i></button>',
            responsive: [ {
                breakpoint: TABLETBREAK,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3,
                    dots: true
                }
            }, {
                breakpoint: MOBILEBREAK,
                settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    dots: true
                }
            } ]
        });
        $(".compre-por-pet .navegation-bar").slick({
            infinite: true,
            slidesToShow: 7,
            slidesToScroll: 2,
            arrows: false,
            speed: 500,
            nextArrow: '<button type="button" class="slick-arrow slick-next"><i class="ico-arrow"></i></button>',
            prevArrow: '<button type="button" class="slick-arrow slick-prev"><i class="ico-arrow"></i></button>',
            responsive: [ {
                breakpoint: TABLETBREAK,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3,
                    dots: true
                }
            }, {
                breakpoint: MOBILEBREAK,
                settings: {
                    slidesToShow: 3,
                    slidesToScroll: 3,
                    dots: true
                }
            } ]
        });
    },
    newsletter: function() {
        if ($.cookie("newsletter") != "true") {
            // $("#newsletter-modal").modal({
            //     fadeDuration: 100,
            //     showClose: false
            // });
            $(".try.is-button").on("click", function() {
                $(".box.active").removeClass("active");
                $(".initial.box").addClass("active");
            });
            fns.newsletter($("#nesletter-modal-form"));
            $.cookie("newsletter", "true");
        }
    },
    abas: function() {
        $(window).load(function() {
            $(".colections.slide-shelf .colecion:not(.active) ul").slick("unslick");
        });
        $(".abas li a").on("click", function(e) {
            e.preventDefault();
            $(".abas li a").removeClass("aba-active");
            $(this).addClass("aba-active");
            var id = $(this).attr("href");
            $(".colections .colecion").removeClass("active");
            $(".colections " + id).addClass("active");
            $(".colections.slide-shelf .colecion:not(.active) ul").slick("unslick");
            slider.slideShelf($(".colections.slide-shelf .colecion.active ul"), 4, 3, 1, 4, 3, 1, false, false, false, true, true, true);
        });
    },
    init: function() {
        home.abas();
        home.slider();
        home.newsletter();
        if (window.innerWidth > 425) {
            home.getBlogPosts();
        }
        home.instagramFeed();
    }
};

var prodsDetails = new Array();

var buyTogether = {
    buildBuyTogether: function() {
        var btHtml = $("#divCompreJunto").html();
        $(".productBuyTogether").html(btHtml);
        $("a#lnkComprar").text("Comprar Junto");
        $("a#lnkComprar").on("click", function(e) {
            e.preventDefault();
        });
        $(".productBuyTogether tr").each(function() {
            var thisTr = $(this);
            var u = $(this).find(".comprar-junto > a").attr("href");
            u = u.substring(u.indexOf("?"));
            var urlParams;
            (window.onpopstate = function() {
                var match, pl = /\+/g, search = /([^&=]+)=?([^&]*)/g, decode = function(s) {
                    return decodeURIComponent(s.replace(pl, " "));
                }, query = u;
                urlParams = {};
                while (match = search.exec(query)) {
                    urlParams[decode(match[1])] = decode(match[2]);
                }
            })();
            var idProds = [];
            var skusProds = [];
            var tdTable, object;
            $.when($.ajax({
                url: "/produto/sku/" + urlParams["?sku"],
                async: false
            }).done(function(data) {
                idProds.push(data[0].IdProduct);
                thisTr.find(".itemA").attr("data-idprod", data[0].IdProduct);
            }), $.ajax({
                url: "/produto/sku/" + urlParams["sku"],
                async: false
            }).done(function(data) {
                idProds.push(data[0].IdProduct);
                thisTr.find(".itemB").attr("data-idprod", data[0].IdProduct);
            })).then(function() {
                $.getScript("//io.vtex.com.br/vtex.js/1.0.0/vtex.min.js").done(function(script, textStatus) {
                    $.each(idProds, function(i) {
                        vtexjs.catalog.getProductWithVariations(idProds[i]).done(function(product) {
                            if (thisTr.find(".itemA").attr("data-idprod") == product.productId) {
                                tdTable = thisTr.find(".itemA");
                            } else {
                                tdTable = thisTr.find(".itemB");
                            }
                            var html = "";
                            $.each(product.skus, function(i) {
                                if (product.skus[i].available) {
                                    x = i;
                                    return false;
                                }
                            });
                            price = '<div class="price">';
                            if (product.skus[x].listPrice > product.skus[x].bestPrice) {
                                price += '<span class="old-price">' + product.skus[x].listPriceFormated + '</span><span class="best-price">' + product.skus[x].bestPriceFormated + "</span>";
                            } else {
                                price += '<span class="best-price">' + product.skus[x].bestPriceFormated + "</span>";
                            }
                            price += "</div>";
                            tdTable.find("h3").wrap("<div class='contSide'></div>").find("a").text(product.name);
                            var $title = tdTable.find("h3").clone();
                            html += "<h3>" + $title.html() + "</h3>";
                            html += price;
                            tdTable.find("h3").after(price);
                            tdTable.find("img").attr("src", product.skus[x].image.replace("90-90", "300-300"));
                            if (product.dimensions.length > 0 && product.skus.length > 1) {
                                $.each(product.dimensions, function(i) {
                                    html += '<div class="select-' + product.dimensions[i] + '"><select id="' + product.dimensions[i] + '" class="change-sku">';
                                    if (product.dimensionsMap[product.dimensions[i]].length > 1) {
                                        html += '<option value=""  selected="true" disabled="disabled">Escolha ' + product.dimensions[i] + "</option>";
                                        $.each(product.dimensionsMap[product.dimensions[i]], function(x) {
                                            html += '<option value="' + product.dimensionsMap[product.dimensions[i]][x] + '"data-id="' + product.skus[x].sku + '" best-price="' + product.skus[x].bestPriceFormated + '">' + product.dimensionsMap[product.dimensions[i]][x] + "</option>";
                                            skusProds.push(product.skus[x]);
                                        });
                                    } else {
                                        html += '<option selected="true" disabled="disabled" value="' + product.dimensionsMap[product.dimensions[i]][x] + '">' + product.dimensionsMap[product.dimensions[i]][x] + "</option>";
                                    }
                                    html += "</select></div>";
                                });
                                tdTable.find(".contSide").html(html);
                            } else {
                                tdTable.attr("data-sku", product.skus[0].sku);
                            }
                            prodsDetails.push(product);
                            console.log(product.skus[i]);
                        });
                    });
                    function recalc() {
                        var valueA = parseInt($("td.itemA").find("span.best-price").text().replace(/[R$ ,]/g, ""));
                        var valueB = parseInt($("td.itemB").find("span.best-price").text().replace(/[R$ ,]/g, ""));
                        var total = helper.toReal(valueA + valueB);
                        if ($("td.buy .installment strong").size() > 0) {
                            var instalment = parseInt($("td.buy .installment strong").first().text().replace("x"));
                            var totalInstaments = parseFloat(total.replace(",", ".")) / instalment;
                            totalInstaments = helper.toReal(totalInstaments.toFixed(2).toString().replace(".", ""));
                            $("td.buy .installment strong").last().text("R$ " + totalInstaments);
                        }
                        var total = "Por R$ " + total;
                        $("td.buy .best-price strong").text(total);
                    }
                    $("body").on("change", "select.change-sku", function() {
                        var currentPrice = $(this).find("option:selected").attr("best-price");
                        var sku = $(this).find("option:selected").attr("data-sku");
                        $(this).parents("td").attr("data-sku", sku);
                        $(this).parents(".contSide").find("span.best-price").text(currentPrice);
                        recalc();
                    });
                }).fail(function(jqxhr, settings, exception) {});
            });
        });
    },
    changeSkuBuyTogether: function() {
        $(".productBuyTogether .contSide").on("change", "select", function() {
            var skuSelect = "{";
            var thisElem = $(this);
            $.each(prodsDetails, function(i) {
                if (prodsDetails[i].productId == thisElem.parents('[class^="item"]').attr("data-idprod")) {
                    w = i;
                }
            });
            i = 0;
            $(this).parents('[class^="item"]').find("select").each(function() {
                if ($(this).find("option:selected").val() == "") {
                    return false;
                } else {
                    tId = $(this).attr("id");
                    tVal = $(this).find("option:selected").val();
                    skuSelect += '"' + tId + '": "' + tVal + '",';
                    i++;
                }
            });
            skuSelect += "}";
            if ($(this).parents('[class^="item"]').find("select").length == i) {
                skuSelect = skuSelect.replace(",}", "}");
                var obj = jQuery.parseJSON(skuSelect);
                $.each(prodsDetails[w].skus, function(i) {
                    if (JSON.stringify(obj) == JSON.stringify(prodsDetails[w].skus[i].dimensions)) {
                        if (prodsDetails[w].skus[i].available) {
                            thisElem.parents('[class^="item"]').attr("data-sku", prodsDetails[w].skus[i].sku);
                            thisElem.removeClass("inactive");
                            return false;
                        } else {
                            alert("Infelizmente esta combinação está Indisponível.");
                        }
                    } else {
                        thisElem.parents('[class^="item"]').attr("data-sku", "");
                        thisElem.addClass("inactive");
                    }
                });
            }
        });
    },
    buyBuyTogether: function() {
        $(".productBuyTogether .buy .comprar-junto a").on("click", function(event) {
            event.preventDefault();
            var url = $(this).attr("href");
            var sku1 = $(this).parents('[class^="productBuyTogether"]').find(".itemA").attr("data-sku");
            var sku2 = $(this).parents('[class^="productBuyTogether"]').find(".itemB").attr("data-sku");
            if (sku1 == "" || sku2 == "" || typeof sku1 == "undefined" || typeof sku2 == "undefined") {
                alert("Por favor escolha o tamanho do produto");
            } else {
                $(this).text("Aguarde...");
                $.ajax({
                    url: "/checkout/cart/add?sku=" + sku1 + "&qty=1&seller=1&sku=" + sku2 + "&qty=1&seller=1&redirect=false&sc=1",
                    type: "GET",
                    crossDomain: true,
                    dataType: "html",
                    success: function() {
                        setTimeout(function() {
                            window.location = window.location = "https://" + window.location.hostname + "/checkout/#/cart";
                        }, 1e3);
                    },
                    error: function() {
                        $(this).text("Comprar junto");
                    }
                });
            }
        });
    }
};

var product = {
    installmentToggle: function() {
        var maxInstallmentText = $(".valor-dividido").text();
        if ($(".other-payment-method-ul li").length > 1) {
            $(".other-payment-method").prepend('<div class="installmentToggle"><span>Ver opções de parcelamento</span></div>');
            $(".installmentToggle span").on("click", function() {
                $(".other-payment-method-ul").stop(true, true).slideToggle();
            });
        } else {
            $(".other-payment-method").prepend('<div class="installmentToggle"></div>');
        }
        $(".other-payment-method-ul li").each(function(i) {
            if (i != 0) {
                var parcela = $(this).find("span:first-child").text();
                var valor = $(this).find("strong").text();
                var juros = $(this).find("span.other-payment-method-intereset-no").size() == 1 ? " Sem juros " : " Com juros ";
                var template = '<div class="left">' + parcela.replace("de", "") + juros + '</div><div class="right">' + valor + "</div>";
                $(this).html(template);
            }
        });
        $(".other-payment-method-ul").prepend("<li><span>PARCELA</span><span>VALOR</span>");
    },
    qtl: function() {
        $(".prodQtd span").live("click", function() {
            var _this = $(this);
            var qtl = parseInt($(".prodQtd .qtdValue").val());
            var max;
            var SKUS = skuJson.skus;
            var SKU = $("input.sku-picked").length > 0 ? $("input.sku-picked").attr("data-value") : max = SKUS[0].availablequantity;
            if (SKU != undefined) {
                SKUS.map(function(item, i) {
                    if (SKU == item.dimensions.Cor || SKU == item.dimensions.Tamanho) {
                        max = item.availablequantity;
                    }
                });
                if (_this.hasClass("removeItem")) {
                    if (qtl == 0) {
                        qtl = 0;
                    } else {
                        qtl--;
                    }
                } else {
                    if (qtl >= max) {
                        qtl = max;
                        alert("Quantidade máxima disponível atingida.");
                    } else {
                        qtl++;
                    }
                }
                $(".prodQtd .qtdValue").val(qtl);
            }
        });
    },
    thumbSlider: function() {
        $("#show .thumbs img").each(function() {
            var _this = $(this);
            var src = _this.attr("src").replace("-100-100", "-400-400");
            _this.attr("src", src);
        });
        $("#show ul.thumbs").slick({
            dots: false,
            arrows: true,
            vertical: true,
            slidesToShow: 4,
            slidesToScroll: 4,
            infinite: false,
            nextArrow: '<button type="button" class="slick-arrow slick-next"><i class="ico-arrow"></i></button>',
            prevArrow: '<button type="button" class="slick-arrow slick-prev"><i class="ico-arrow"></i></button>',
            responsive: [ {
                breakpoint: 1024,
                settings: {
                    dots: true,
                    arrows: true,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    vertical: false,
                    infinite: true
                }
            }, {
                breakpoint: 425,
                settings: {
                    dots: true,
                    arrows: false,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    vertical: false,
                    infinite: true
                }
            } ]
        });
    },
    skuTamanho: function() {
        $.each(skuJson.skus, function(i, sku) {
            var seletor = sku.dimensions.Tamanho;
            if (sku.available) {
                var price = "<span>" + sku.bestPriceFormated + "<span>";
            } else {
                var price = "<span>Esgotado<span>";
            }
            $('.sku-selector-container input[data-value="' + seletor + '"]').next("label").append(price);
        });
    },
    hideButtons: function() {
        if (!skuJson.available) {
            $(".buyProduct .qty, .button-strolk-color1 ").hide().css("display:none !important;");
        }
    },
    flagDiscount: function() {
        for (var x = 0; x < skuJson.skus.length; x++) {
            if (skuJson.skus[x].available) {
                var bestPrice = skuJson.skus[x].bestPrice;
                var listPrice = skuJson.skus[x].listPrice;
                if ($(".valor-de ").length > 0) {
                    var discountPercentage = (listPrice - bestPrice) / listPrice * 100;
                    discountPercentage = parseFloat(discountPercentage);
                    discountPercentage = discountPercentage.toFixed(0);
                    $("#show #include").prepend('<div class="flagDiscount active" style="display: block;"><span><strong>' + discountPercentage + "% </strong>off</span></div>");
                }
                x = 1e5;
            }
        }
    },
    ajaxPag: function() {
        if ($(".notifyme").is(":visible")) {
            $(".wrapper.frete").hide();
        } else {
            $(".wrapper.frete #popupCalculoFreteWrapper a").click();
            $(".wrapper.frete").show();
        }
    },
    convertToSlug: function(text) {
        const a = 'àáäâãèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/_,:;'
        const b = 'aaaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------'
        const p = new RegExp(a.split('').join('|'), 'g')
        return text.toString().toLowerCase().trim()
          .replace(p, c => b.charAt(a.indexOf(c))) // Replace special chars
          .replace(/&/g, '-and-') // Replace & with 'and'
          .replace(/[\s\W-]+/g, '') // Replace spaces, non-word characters and dashes with a single dash (-)
    },
    formatPrice: function(num){
        var price = num;
        price = num.toString();
    
        if(price.length >= 8){
            price = price.replace(/(\d{6})(?=(\d{2})+(?!\d))/g , "$&,")
            price = 'R$' + price.replace(/(\d{2})(?=(\d\d\d)+(?!\d))/g, "$1.")
        }else if(price.length >= 6){
            price = price.replace(/(\d{4})(?=(\d{2})+(?!\d))/g , "$&,")
            price = 'R$' + price.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1.")
        }else if(price.length >= 5){
            price = 'R$' + price.replace(/(\d{3})(?=(\d{2})+(?!\d))/g , "$&,")
        }else if(price.length <= 4){
            price = 'R$' + price.replace( /\d{1,2}(?=(\d{2})+(?!\d))/g , "$&,")
        }
        return price;
    },    
    verificaTabelaFrete: function(){
        $(document).ajaxStop(function(){   
            let el = document.getElementById("btnFreteSimulacao");
            if(el){
                el.addEventListener("click", function(){
                    console.log('clicou')
                    setTimeout(function(){
                        let tabela = $('body.product .frete .freight-values table').is(':visible');
                        if(tabela){
                            product.simulaFrete();
                        }
                    },1000);
                }); 
            }
        })

        $('.addItem, .removeItem').on('click', function(e){
            setTimeout(function(){
                let tabela = $('body.product .frete .freight-values table').is(':visible');
                if(tabela){
                    product.simulaFrete();
                }
            },500);
        });
    },
    simulaFrete: function(){   
        let items = [{
            id: skuJson_0.skus[0].sku,  // sku do item
            quantity: parseInt($('.qtdValue').val()),
            seller: '1'
        }];  
        console.log(items[0].quantity)    
        let postalCode = $('#txtCep').val();                
        let country = 'BRA';
        
        vtexjs.checkout.simulateShipping(items, postalCode, country).done(function(result) {
            let _sla =  result.logisticsInfo[0].slas; 
            _sla.map(function(i,v){
                let _valuePrice = product.formatPrice(i.price);
                $('body.product .frete .freight-values table tbody tr').each(function(){
                    let txt = $(this).text().indexOf(i.id) > -1;
                    if (txt){
                        let idClass = i.id;
                        idClass = idClass.toLowerCase()
                        idClass = idClass.replace('13edce9','');
                        idClass = product.convertToSlug(idClass); /*.replace('(','').replace(')', '').replace(' ','');*/

                        $(this).addClass(idClass)
                    }

                    if (i.id === "Entrega Econômica"){
                        if ($(this).hasClass('entregaeconomica')){
                            $(this).find('td:first-child').text(_valuePrice);
                        }
                    }
                    if (i.id === "Awr Express"){
                        if ($(this).hasClass('awrexpress')){
                            $(this).find('td:first-child').text(_valuePrice);
                        }
                    }
                    if (i.id === "FM TRANSPORTES"){
                        if ($(this).hasClass('fmtransportes')){
                            $(this).find('td:first-child').text(_valuePrice);
                        }
                    }
                    if (i.id === "Expressa (Motoboy)"){
                        if ($(this).hasClass('expressamotoboy')){
                            $(this).find('td:first-child').text(_valuePrice);
                        }
                    }
                })
            })
            
        });
    },
    init: function() {
        product.thumbSlider();
        product.qtl();
        product.installmentToggle();
        product.skuTamanho();
        product.hideButtons();
        product.flagDiscount();
        product.verificaTabelaFrete();
        $("ul.Cor input").each(function() {
            var cor = $(this).attr("data-value");
            $(this).next("label").attr("data-val", cor);
        });
        if ($(".productComplementary ul li").size() == 0) {
            $(".productComplementary").hide();
        }
        if ($(".sku-selector-container label").size() > 1) {
            $(".sku-selector-container label").on("click", function() {
                setTimeout(function() {
                    product.installmentToggle();
                }, 2500);
            });
        }
        var txt = $(".productDetails .productDescription").text().length;
        if (txt != 0) {
            $(".productDetails").show();
        }
        var txt = $("#caracteristicas").text().length;
        if (txt == 0) {
            $(".title.Caracteristicas").hide();
        }
        var produtoTitle = $("h1.productTitle").text();
        $(".title.descricao").text($(".title.descricao").text() + " - " + produtoTitle);
        $(".title.Caracteristicas").text($(".title.Caracteristicas").text() + " - " + produtoTitle);
        slider.slideShelf($(".slide-shelf .shelf > ul"), 4, 3, 1, 4, 3, 1, false, false, false, true, true, true);
        $("h4#divTitulo").remove();
        $("#divCompreJunto").prepend('<p id="divTitulo">Aproveite e compre junto</p>');
        if (!$("body").hasClass("kit")) {
            if ($("#divCompreJunto table").length) {
                buyTogether.buildBuyTogether();
                setTimeout(function() {
                    buyTogether.changeSkuBuyTogether();
                    buyTogether.buyBuyTogether();
                    $(".productBuyTogether").fadeIn(400);
                }, 4e3);
            }
        }
        product.ajaxPag();
        $(window).ajaxStop(function() {
            product.ajaxPag();
        });
    }
};

var account = {
    buildModal: function() {
        $("#editar-perfil").css("display", "none");
        $("#address-edit").css("display", "none");
        $("#address-remove").css("display", "none");
        $("#edit-data-link").attr({
            rel: "modal:open"
        });
        $(".address-update").attr({
            rel: "modal:open"
        });
        $("#address-update").each(function() {
            $(this).attr({
                rel: "modal:open"
            });
        });
        $(".delete").each(function() {
            $(this).attr({
                rel: "modal:open"
            });
        });
        $(".modal-footer").each(function() {
            $(this).append('<a href="#close-modal" rel="modal:close" class="btn-link">Cancelar</a>');
        });
    },
    init: function() {
        account.buildModal();
    }
};

var institutional = {
    dropdown: function() {
        $(".institutionalLinksList li a").each(function() {
            if (window.location.pathname == $(this).attr("href")) {
                $(this).addClass("active");
            }
        });
        $(".institutionalLinksList").append('<div class="wrap-slide"></div>');
        $(".institutionalLinksList .wrap-slide").append($(".institutionalLinksList li"));
        var txt = $(".institutionalLinksList a.active").text();
        $(".institutionalLinksList").prepend('<li class="selected active">' + txt + " <i class='ico-arrow'></i></li>");
        $(".institutionalLinksList li.selected.active").on("click", function() {
            $(".institutionalLinksList .wrap-slide").slideToggle();
        });
        if (window.innerWidth < 768) {
            $(".institutionalLinksList .wrap-slide").slideToggle();
        }
    },
    formTrabalheConosco: function() {
        $("#trabale-conosco").on("submit", function(e) {
            e.preventDefault();
            var formFields = fns.formObject($("#trabale-conosco"));
            if (fns.validaEmail(formFields.email)) {
                fns.saveMasterDate("TC", formFields, "Mensagem enviada com sucesso. Em breve retornaremos, obrigado.", $("#trabale-conosco"), true);
            }
        });
    },
    faleConosco: function() {
        $("#fale-conosco").on("submit", function(e) {
            e.preventDefault();
            var formFields = fns.formObject($("#fale-conosco"));
            console.log(formFields);
            if (fns.validaEmail(formFields.email)) {
                fns.saveMasterDate("FC", formFields, "Mensagem enviada com sucesso. Em breve retornaremos, obrigado", $("#fale-conosco"), true);
            }
        });
    },
    init: function() {
        institutional.dropdown();
        institutional.faleConosco();
        institutional.formTrabalheConosco();
        fns.acordeon();
    }
};

$(document).ready(function() {
    $(".helperComplement").remove();
    global.init();
    if (HOME) {
        home.init();
    }
    if (PRODUTO) {
        product.init();
    }
    if (ACCOUNT) {
        account.init();
    }
    if (CATALOG) {
        catalog.init();
    }
    if (EMPTYSEARCH) {
        catalog.emptySearch();
    }
    if (INSTITUCIONAL) {
        institutional.init();
    }
    if (SEARCH) {}
});